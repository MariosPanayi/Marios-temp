install.packages(tidyverse)
install.packages("tidyverse")
# Title: CoulbournDataExtraction
## Author: Marios Panayi
## Date: 16-DEC-2020
## Purpose: Extract Data from Raw COUlbourn Files
## Notes: Data from NIDA Pilots
# Load Packagaes ----------------------------------------------------------
## Packages for data organisation and plotting
library(tidyverse)
library(knitr)
# Package for relative file paths
library(here)
# library(ggpubr)
library(cowplot)
library(ggsignif)
library(patchwork)
library(RColorBrewer)
## Packages for Data analysis
library(afex)
afex_options(emmeans_model = "multivariate")# use multivariate model for all follow-up tests.
library(emmeans)
# install.packages("devtools")
# devtools::install_github("crsh/papaja")
# library(papaja)
# library(knitr)
# remotes::install_github("noamross/redoc")
# library(redoc)
here(rawdata)
here("rawdata")
here("rawdata", "Marios",'ConditionedReinforcement', "CRF_MagTrain_Sess1.txt")
?read_delim
rawdata <- read_tsv(filename)
filename <- here("rawdata", "Marios",'ConditionedReinforcement', "CRF_MagTrain_Sess1.txt")
rawdata <- read_tsv(filename)
View(rawdata)
rawdata %>%
which(TIme == 0
)
rawdata %>%
which(Time == 0
)
rawdata %>%
which(Time = 0
)
which(rawdata$Time = 0)
which(rawdata$Time == 0)
length(rawdata)
size(rawdata)
nrow(rawdata)
# indices wher time = 0
start = which(rawdata$Time == 0)
end = start -1
end
end[-1]
c(end, nrow(rawdata))
start = which(rawdata$Time == 0)
end = start -1
end = end[-1]
end = c(end, nrow(rawdata))
startend
start
end
filename <- "CRF_MagTrain_Sess1.txt"
filepath <- here("rawdata", "Marios",'ConditionedReinforcement', filename)
# Coulbourn files are tab separated value .txt files
rawdata <- read_tsv(filepath)
filename[-4]
filename
tail(filename,4)
tail(filename,-4)
head(filename, -1)
?head
head(filename)
head(c(filename),-2)
strsplit(filename, ".")
strsplit(filename, ".txt")
strsplit(filename, ".txt")
prefix <- strsplit(filename, ".txt")
prefix
prefix <- [strsplit(filename, ".txt")]
prefix[[1]]
unnest(prefix)
squeeze(prefix)
drop(prefix)
filename <- "CRF_MagTrain_Sess1.txt"
filepath <- here("rawdata", "Marios",'ConditionedReinforcement', filename)
# Coulbourn files are tab separated value .txt files
rawdata <- read_tsv(filepath)
# Separate subjects -------------------------------------------------------
# Coulbourn will put all the data you have asked for in a long format stack with subjects changing after a variable number of columns
## Note that if you try and extract by identifying unique subjects you might accidentally ignore that a subject was run multiple times
## Instead, Coulbourn timetsamps always start at t = 0, so this can be used to identify the indices of every new subject
# Start and end indices of each subject
start = which(rawdata$Time == 0)
end = start -1
end = end[-1]
end = c(end, nrow(rawdata))
head(c(filename),-2)
prefix <- strsplit(filename, ".txt")
prefix <- Prefix[[1]]
prefix <- prefix[[1]]
# Read in data file -------------------------------------------------------
filename <- "CRF_MagTrain_Sess1.txt"
filepath <- here("rawdata", "Marios",'ConditionedReinforcement', filename)
# Coulbourn files are tab separated value .txt files
rawdata <- read_tsv(filepath)
# Separate subjects -------------------------------------------------------
# Coulbourn will put all the data you have asked for in a long format stack with subjects changing after a variable number of columns
## Note that if you try and extract by identifying unique subjects you might accidentally ignore that a subject was run multiple times
## Instead, Coulbourn timetsamps always start at t = 0, so this can be used to identify the indices of every new subject
# Start and end indices of each subject
start = which(rawdata$Time == 0)
end = start -1
end = end[-1]
end = c(end, nrow(rawdata))
head(c(filename),-2)
prefix <- strsplit(filename, ".txt")
prefix <- prefix[[1]]
c(1:10)
start
nrow(start)
count(start)
unique(start)
ncol(start)
length(start)
# Count the number of subjects/sessions in the file
totalSubj = length(which(rawdata$Time == 0))
c(1:totalSubj)
summary(rawdata)
rawdata[1:5]
rawdata[,1:5]
rawdata[1:5,]
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[1]:end[i], ]
temp
# save temp data with appropriate filename
}
start
end
start[0]
start[1]
start[2]
end
i = 1
rawdata[start[1]:end[i], ]
for (i in c(1:length(start))) {
temp <- rawdata[start[1]:end[i], ]
print(temp)
# save temp data with appropriate filename
}
temp = rawdata[start[1]:end[i], ]
# for each subject
for (i in c(1:length(start))) {
temp = rawdata[start[1]:end[i], ]
print(temp)
# save temp data with appropriate filename
}
rm(temp)
# for each subject
for (i in c(1:length(start))) {
temp = rawdata[start[1]:end[i], ]
print(temp)
rm(temp)
# save temp data with appropriate filename
}
# rm(temp)
# for each subject
for (i in c(1:length(start))) {
temp = rawdata[start[i]:end[i], ]
print(temp)
# rm(temp)
# save temp data with appropriate filename
}
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
print(temp)
# save temp data with appropriate filename
}
temp$Subject[1]
SubjectNum = temp$Subject[1]
RunNumber = temp$Run[1]
c(prefix,SubjectNum,RunNumber)
paste(c(prefix,SubjectNum,RunNumber), sep = "_")
paste(c(prefix,SubjectNum,RunNumber), collapse = "_")
paste(c(prefix,, "Rat",RunNumber,"Run"), collapse = "_")
paste(c(prefix, "Rat",RunNumber,"Run"), collapse = "_")
paste(c(prefix, "Rat", SubjectNum, "Run",RunNumber), collapse = "_")
filepath <- here("rawdata", "Marios",'ConditionedReinforcement', paste(tempfilename, ".csv"))
tempfilename <- paste(c(prefix, "Rat", SubjectNum, "Run",RunNumber), collapse = "_")
filepath <- here("rawdata", "Marios",'ConditionedReinforcement', paste(tempfilename, ".csv"))
filepath
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
print(temp)
# save temp data with appropriate filename
SubjectNum = temp$Subject[1]
RunNumber = temp$Run[1]
tempfilename <- paste(c(prefix, "Rat", SubjectNum, "Run",RunNumber), collapse = "_")
filepath <- here("rawdata", "Marios",'ConditionedReinforcement', paste(tempfilename, ".csv"))
write_csv(temp, filepath)
}
tempfilename
aste(tempfilename, ".csv")
paste(tempfilename, ".csv")
paste(tempfilename, ".csv", sep = "")
filename <- "CRF_MagTrain_Sess1.txt"
folderpath <- here("rawdata", "Marios",'ConditionedReinforcement')
filepath <- here(folderpath, filename)
filepath
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
SubjectNum = temp$Subject[1]
RunNumber = temp$Run[1]
tempfilename <- paste(c(prefix, "Rat", SubjectNum, "Run",RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
a = CRF_MagTrain_Sess1_Rat_9______Run_1
a = "CRF_MagTrain_Sess1_Rat_9______Run_1"
str_split(filename, ".txt")
strsplit(a,"_")
b = strsplit(a,"_")
b
b[[1]]
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
SubjectNum = temp$Subject[1]
RunNumber = temp$Run[1]
tempfilename <- paste(c(prefix, "Rat", SubjectNum, "Run",RunNumber), collapse = "")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
filename
str_replace_all(filename, "_", "")
# Grab filename for naming convention and combine with subject number
prefix <- strsplit(filename, ".txt")
prefix <- prefix[[1]]
prefix <- str_replace_all(prefix, "_", "")
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
SubjectNum = temp$Subject[1]
RunNumber = temp$Run[1]
tempfilename <- paste(c(prefix, "Rat", SubjectNum, "Run",RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
# save temp data with appropriate filename
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum = str_replace_all(SubjectNum, "_", "")
SubjectNum
# Grab filename for naming convention and combine with subject number
prefix <- strsplit(filename, ".txt")
prefix <- prefix[[1]]
prefix <- str_replace_all(prefix, "_", "")
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum = str_replace_all(SubjectNum, "_", "")
RunNumber = paste(c("Run", temp$Run[1], collapse = ""))
RunNumber = str_replace_all(RunNumber, "_", "")
tempfilename <- paste(c(prefix, SubjectNum,RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
# Grab filename for naming convention and combine with subject number
prefix <- strsplit(filename, ".txt")
prefix <- prefix[[1]]
prefix <- str_replace_all(prefix, "_", "")
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum = str_replace_all(SubjectNum, "_", "")
RunNumber = paste(c("Run", temp$Run[1], collapse = ""))
tempfilename <- paste(c(prefix, SubjectNum,RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
RunNumber
RunNumber = paste(c("Run", temp$Run[1], collapse = ""))
RunNumber
temp$Run[1]
RunNumber = paste(c("Run", temp$Run[1]), collapse = "")
RunNumber
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
# Clean SubjNumber
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum = str_replace_all(SubjectNum, "_", "")
RunNumber = paste(c("Run", temp$Run[1]), collapse = "")
# Clean RUn number
tempfilename <- paste(c(prefix, SubjectNum,RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
# Clean SubjNumber
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum = str_replace_all(SubjectNum, "_", "")
RunNumber = paste(c("Run", temp$Run[1]), collapse = "")
# Clean RUn number
tempfilename <- paste(c(prefix, SubjectNum,RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
read_csv(here(filepath))
colnames(rawdata)
colnames(rawdata)
names(rawdata)[12] <- "LLR_On"
names(rawdata)[13] <- "RLR_On"
names(rawdata)[14] <- "Mag_On"
names(rawdata)[15] <- "A4_On"
names(rawdata)[16] <- "LLR_Off"
names(rawdata)[17] <- "RLR_Off"
names(rawdata)[18] <- "Mag_Off"
names(rawdata)[19] <- "A4_Off"
View(rawdata)
# Read in data file -------------------------------------------------------
filename <- "CRF_MagTrain_Sess1.txt"
folderpath <- here("rawdata", "Marios",'ConditionedReinforcement')
filepath <- here(folderpath, filename)
# Coulbourn files are tab separated value .txt files
rawdata <- read_tsv(filepath)
# Clean up column naming conventions - Assumes 4 response options on Coulbourn setup
names(rawdata)[12] <- "LLR_On"
names(rawdata)[13] <- "RLR_On"
names(rawdata)[14] <- "Mag_On"
names(rawdata)[15] <- "A4_On"
names(rawdata)[16] <- "LLR_Off"
names(rawdata)[17] <- "RLR_Off"
names(rawdata)[18] <- "Mag_Off"
names(rawdata)[19] <- "A4_Off"
# Separate subjects -------------------------------------------------------
# Coulbourn will put all the data you have asked for in a long format stack with subjects changing after a variable number of columns
## Note that if you try and extract by identifying unique subjects you might accidentally ignore that a subject was run multiple times
## Instead, Coulbourn timetsamps always start at t = 0, so this can be used to identify the indices of every new subject
# Start and end indices of each subject
start = which(rawdata$Time == 0)
end = start -1
end = end[-1]
end = c(end, nrow(rawdata))
# Grab filename for naming convention and combine with subject number
prefix <- strsplit(filename, ".txt")
prefix <- prefix[[1]]
prefix <- str_replace_all(prefix, "_", "")
# for each subject
for (i in c(1:length(start))) {
temp <- rawdata[start[i]:end[i], ]
# save temp data with appropriate filename
# Clean SubjNumber
SubjectNum = paste(c("Rat", temp$Subject[1]), collapse = "")
SubjectNum = str_replace_all(SubjectNum, "_", "")
RunNumber = paste(c("Run", temp$Run[1]), collapse = "")
# Clean RUn number
tempfilename <- paste(c(prefix, SubjectNum,RunNumber), collapse = "_")
tempfilename <- paste(tempfilename, ".csv", sep = "")
filepath <- here(folderpath, tempfilename)
write_csv(temp, filepath)
}
